import{j as e,r as j}from"./index-DngLVFUg.js";import{a as H,e as _,f as T,u as Y}from"./shopifyIdUtils-PhKRAdsZ.js";import{P as $}from"./sortable.esm-BLq9_7uD.js";import{r as M}from"./routes-C5ziuI-K.js";import{c as q,u as G,M as Z}from"./index-Z-KbNkSr.js";import{u as Q,F as X,T as K,S as w,a as W,b as J,c as ee}from"./use-debounce-DCREou93.js";import{S as P,F as ae}from"./index-BvWictZX.js";import{G as F,d as t}from"./index-CZBhWrIY.js";import{B as te}from"./index-B2HYwkQ5.js";import{L,o as V,p as se,u as le}from"./components-DCDtNDXQ.js";import{P as re,a as ne,b as ie,d as oe,c as ce}from"./index-hoEkgPmj.js";import{m as k}from"./messages-BV2XNudo.js";import{D as A}from"./datepicker-Bhj_Xp2q.js";function I(a){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M17.263 2.177a1.75 1.75 0 0 1 2.474 0l2.586 2.586a1.75 1.75 0 0 1 0 2.474L19.53 10.03l-.012.013L8.69 20.378a1.753 1.753 0 0 1-.699.409l-5.523 1.68a.748.748 0 0 1-.747-.188.748.748 0 0 1-.188-.747l1.673-5.5a1.75 1.75 0 0 1 .466-.756L14.476 4.963ZM4.708 16.361a.26.26 0 0 0-.067.108l-1.264 4.154 4.177-1.271a.253.253 0 0 0 .1-.059l10.273-9.806-2.94-2.939-10.279 9.813ZM19 8.44l2.263-2.262a.25.25 0 0 0 0-.354l-2.586-2.586a.25.25 0 0 0-.354 0L16.061 5.5Z"},child:[]}]})(a)}function de(a){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z",opacity:".87"},child:[]},{tag:"path",attr:{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},child:[]}]})(a)}const u=q(),me=[u.display({id:"select",size:50,header:({table:a})=>e.jsx(t.Checkbox,{className:"ps-3.5","aria-label":"Select all rows",checked:a.getIsAllPageRowsSelected(),onChange:()=>a.toggleAllPageRowsSelected()}),cell:({row:a})=>e.jsx(t.Checkbox,{className:"ps-3.5","aria-label":"Select row",checked:a.getIsSelected(),onChange:()=>a.toggleSelected()})}),u.accessor("id",{id:"subscripitionId",size:200,header:"Subscription ID",cell:({row:a})=>e.jsx(L,{to:`${a.original.id}`,className:"text-sm text-primary",children:a.original.id})}),u.display({id:"variantTitle",size:200,header:"Product/Variant",cell:({row:a})=>e.jsx(t.Text,{className:"text-sm",children:a.original.variantTitle})}),u.display({id:"price",size:150,header:"Price",cell:({row:a})=>{const l=a.original.lineDiscountedPrice;return e.jsx(t.Text,{className:"text-sm",children:l})}}),u.display({id:"quantity",size:100,header:"Quantity",cell:({row:a})=>e.jsx(t.Text,{className:"text-sm",children:a.original.quantity})}),u.display({id:"deliveryPolicy",size:200,header:"Delivery Policy",cell:({row:a})=>e.jsxs(t.Box,{children:[e.jsx(t.Text,{className:"text-sm",children:`Ships every ${a.original.deliveryPolicyIntervalCount} ${a.original.deliveryPolicyInterval.toLowerCase()}`}),e.jsx(t.Text,{className:"text-sm",children:`Charges ${a.original.billingPolicyIntervalCount} ${a.original.billingPolicyInterval.toLowerCase()}`})]})}),u.display({id:"nextBillingDate",size:250,header:"Next Charge Date",cell:({row:a})=>{const l=a.original.nextBillingDate,n=H(l);return e.jsx(t.Box,{className:"flex flex-col",children:e.jsx(t.Text,{className:"text-sm",children:n})})}}),u.display({id:"customer",size:250,header:"Customer",cell:({row:a})=>e.jsxs(t.Box,{className:"flex flex-col",children:[e.jsx(t.Text,{className:"text-sm",children:`${a.original.customerName}`}),e.jsx(t.Text,{className:"text-sm",children:a.original.customerEmail})]})}),u.display({id:"status",size:250,header:"Status",cell:({row:a})=>{const l=a.original.status,n={[P.ACTIVE]:"success",[P.CANCELLED]:"danger",[P.EXPIRED]:"gray",[P.FAILED]:"warning",[P.PAUSED]:"info"};return e.jsxs(t.Box,{className:"flex gap-3 items-center",children:[e.jsx(t.Badge,{renderAsDot:!0,color:n[l]}),e.jsx(t.Text,{className:"capitalize",children:l})]})}}),u.display({id:"actions",size:100,header:"Actions",cell:({row:a})=>{const l=a.original;return e.jsx(ue,{subscripition:l})}})],ue=({subscripition:a})=>{const l=[{icon:e.jsx(te,{}),label:"Reschedule next order"},{icon:e.jsx(I,{}),label:"Edit frequency"},{icon:e.jsx(I,{}),label:"Edit subscription product"},{icon:e.jsx(de,{}),label:"Cancel"},{icon:e.jsx(ae,{}),label:"Delete"}];return e.jsxs(t.Dropdown,{children:[e.jsx(t.Dropdown.Trigger,{children:e.jsx(t.Button,{as:"span",color:"primary",variant:"text",children:e.jsx(t.Text,{className:"text-primary text-sm",children:"Actions"})})}),e.jsx(t.Dropdown.Menu,{className:"min-w-[285px]",children:l.map(({icon:n,label:o},r)=>e.jsx(t.Dropdown.Item,{children:e.jsxs(t.Flex,{align:"center",gap:"2",children:[n&&e.jsx("span",{className:"mr-2",children:n}),e.jsx(t.Text,{children:o})]})},r))})]})};var N=(a=>(a.ACTIVE="active",a.CANCELLED="cancelled",a.EXPIRED="expired",a.FAILED="failed",a.PAUSED="paused",a))(N||{});const b={active:"Active",cancelled:"Cancelled",expired:"Expired",failed:"Failed",paused:"Paused"};var E=(a=>(a.CUSTOMER_ERROR="CUSTOMER_ERROR",a.PAYMENT_ERROR="PAYMENT_ERROR",a.INVENTORY_ERROR="INVENTORY_ERROR",a.OTHER="OTHER",a))(E||{});const xe={CUSTOMER_ERROR:"Customer Error",PAYMENT_ERROR:"Payment Error",INVENTORY_ERROR:"Inventory Error",OTHER:"Other"};function pe({table:a,filtersHanlder:l}){const[n,o]=j.useState(!1),r=a.getSelectedRowModel().rows.length>1,{handleQuerySearch:x,handleStatusChange:i}=l,[p,h]=V(),[s,c]=j.useState(p.get("query")??""),y=Q(s,300);j.useState({});const[f,v]=j.useState("");j.useRef();const[C,g]=j.useState("Search for anything..."),d=[{label:"All",value:"all"},{label:"Customer Email",value:"customer_email"},{label:"Subscription ID",value:"id"},{label:"Product ID",value:"productId"},{label:"Variant ID",value:"variantId"}],D=()=>{a.resetGlobalFilter(),a.resetColumnFilters(),c(""),x(""),i(null),h({})},R={all:"Search for anything...",customer_email:"johndoe@gmail.com",id:"12345",productId:"Product ID 12345",variantId:"Variant Id 12345"},S=m=>{c(m)};return e.jsxs(t.Flex,{align:"center",justify:"between",className:"mb-4",children:[e.jsxs(t.Box,{className:"flex items-center gap-3 flex-grow",children:[e.jsx(t.Select,{placeholder:"Search By ",label:"",options:d,value:f,onChange:m=>{c(""),g(R[m.value]),v(m.value)},className:"w-[25%]"}),e.jsx(t.Input,{type:"search",placeholder:C,value:s,onClear:()=>{D(),c("")},onChange:m=>S(m.target.value),inputClassName:"h-9",clearable:!0,prefix:e.jsx(re,{className:"size-4"}),className:"w-[50%]"}),e.jsx(t.Button,{variant:"flat",onClick:()=>{d.forEach(m=>p.delete(m.value)),x(y,f,d)},className:"h-9",children:"Search"})]}),e.jsx(X,{isOpen:n,drawerTitle:k.products.filters.title,setOpenDrawer:o,children:e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{table:a,filtersHanlder:l})})}),e.jsxs(t.Flex,{align:"center",gap:"3",className:"w-auto",children:[r?e.jsxs(t.Button,{color:"danger",variant:"outline",className:"h-[34px] gap-2 text-sm",onClick:()=>{},children:[e.jsx(ne,{size:18}),"Delete"]}):null,e.jsxs(t.Button,{variant:"outline",onClick:()=>o(!n),className:"h-9 pe-3 ps-2.5",children:[e.jsx(ie,{className:"me-1.5 size-[18px]",strokeWidth:1.7}),"Filters"]}),e.jsxs(t.Button,{variant:"flat",className:"h-9 bg-gray-200/70",onClick:D,children:[e.jsx(oe,{className:"me-1.5 h-[17px] w-[17px]"})," Clear Filters"]}),e.jsx(K,{table:a})]})]})}function he({table:a,filtersHanlder:l}){const{handleStatusChange:n,handleUpdatedDateChange:o,handleCreatedDateChange:r,handleLastBillingAttemptErrorChange:x}=l,[i]=V(),p=Object.values(N).map(s=>({value:s,label:b[s]})),h=Object.values(E).map(s=>({value:s,label:xe[s]}));return e.jsxs(e.Fragment,{children:[e.jsx(w,{options:p,value:i.get("status"),onChange:s=>{n(s)},getOptionValue:s=>s.value,getOptionDisplayValue:s=>z(s.value),displayValue:s=>z(s),dropdownClassName:"!z-20 h-auto top-15",className:"w-auto",label:`${k.products.filters.status.title}`}),e.jsx(A,{selected:i.get("updatedAt")?new Date(i.get("updatedAt")):null,onChange:s=>{const c=s?s.toISOString():null;o(c)},dateFormat:"yyyy-MM-dd'T'HH:mm:ss'Z'",placeholderText:"Select Updated Date",popperPlacement:"bottom-end",showMonthYearPicker:!1,inputProps:{variant:"text",inputClassName:"rizzui-input-container flex items-center peer w-full transition duration-200 px-3.5 py-2 text-sm h-10 rounded-md border border-muted ring-muted bg-transparent",label:"Select Updated Date"},className:"w-full"}),e.jsx(A,{selected:i.get("createdAt")?new Date(i.get("createdAt")):null,onChange:s=>{const c=s?s.toISOString():null;r(c)},dateFormat:"yyyy-MM-dd'T'HH:mm:ss'Z'",placeholderText:"Select Created Date",popperPlacement:"bottom-end",showMonthYearPicker:!1,inputProps:{variant:"text",inputClassName:"rizzui-input-container flex items-center peer w-full transition duration-200 px-3.5 py-2 text-sm h-10 rounded-md border border-muted ring-muted bg-transparent",label:"Select Created Date"},className:"w-full"}),e.jsx(w,{options:h,value:i.get("lastBillingAttemptError"),onChange:s=>{x(s)},getOptionValue:s=>s.value,getOptionDisplayValue:s=>O(s.value),displayValue:s=>O(s),dropdownClassName:"!z-20 h-auto top-15",className:"w-auto",label:"Billing Attempt Error"})]})}function O(a){switch(a){case E.CUSTOMER_ERROR:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"warning",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-warning",children:"Customer Error"})]});case E.INVENTORY_ERROR:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"danger",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-danger",children:"Inventory Error"})]});case E.PAYMENT_ERROR:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"secondary",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-secondary",children:"Payment Error"})]});case E.OTHER:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"secondary",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize",children:"Other Error"})]})}}function z(a){switch(a){case N.ACTIVE:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"success",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-success",children:b[a]})]});case N.CANCELLED:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"warning",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-warning",children:b[a]})]});case N.EXPIRED:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"secondary",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-secondary",children:b[a]})]});case N.FAILED:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"danger",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-danger",children:b[a]})]});case N.PAUSED:return e.jsxs("div",{className:"flex items-center",children:[e.jsx(t.Badge,{color:"info",renderAsDot:!0}),e.jsx(t.Text,{className:"ms-2 font-medium capitalize text-info",children:b[a]})]})}}function ge({pageSize:a,hideFilters:l=!1,hidePagination:n=!1,hideFooter:o=!1,classNames:r={container:"border border-muted rounded-md",rowClassName:"last:border-0 cursor-pointer"},paginationClassName:x,responseData:i}){const{handlePageSizeChange:p,handlePageChange:h,handleStatusChange:s,handleUpdatedDateChange:c,handleQuerySearch:y,handleLastBillingAttemptErrorChange:f,handleCreatedDateChange:v}=W();se(),console.log("responseData",i);const{response:{subscriptionContracts:{pageInfo:C}}}=i,g=j.useMemo(()=>i?je(i):[],[i]),{table:d,setData:D}=G({tableData:g,columnConfig:me,options:{initialState:{pagination:{pageIndex:0,pageSize:a}},enableColumnResizing:!1}});d.getSelectedRowModel().rows.map(m=>m.original);function R(){console.log("handleExportData products table")}const S={handleStatusChange:s,handleQuerySearch:y,handleUpdatedDateChange:c,handleCreatedDateChange:v,handleLastBillingAttemptErrorChange:f};return j.useEffect(()=>{D(g)},[g,D]),e.jsxs(e.Fragment,{children:[!l&&e.jsx(pe,{table:d,filtersHanlder:S}),e.jsx(Z,{table:d,variant:"minimal",classNames:r}),!o&&e.jsx(J,{table:d,onExport:R}),!n&&e.jsx(ee,{table:d,className:ce("py-4",x),onPageSizeChange:p,pageInfo:C,onPageChange:(m,U)=>h(m,U)})]})}const je=(a,l)=>{const{response:{subscriptionContracts:n,shop:{currencyFormats:{moneyFormat:o}}}}=a;return n.edges.map(({node:r})=>{var x,i,p,h,s,c,y,f,v,C,g,d;return{id:_(r.id),variantTitle:((x=r.lines.edges[0])==null?void 0:x.node.variantTitle)||"Unknown Plan",quantity:((i=r.lines.edges[0])==null?void 0:i.node.quantity)||1,lineDiscountedPrice:T(parseFloat((h=(p=r.lines.edges[0])==null?void 0:p.node.lineDiscountedPrice)==null?void 0:h.amount),o)||T(parseFloat("0.0"),o),deliveryPolicyInterval:((s=r.deliveryPolicy)==null?void 0:s.interval)||"N/A",deliveryPolicyIntervalCount:((c=r.deliveryPolicy)==null?void 0:c.intervalCount)||0,billingPolicyInterval:((y=r.billingPolicy)==null?void 0:y.interval)||"N/A",billingPolicyIntervalCount:((f=r.billingPolicy)==null?void 0:f.intervalCount)||0,customerFirstName:((v=r.customer)==null?void 0:v.firstName)||"Unknown",customerLastName:((C=r.customer)==null?void 0:C.lastName)||"Unknown",customerName:((g=r.customer)==null?void 0:g.displayName)||"Unknown",customerEmail:((d=r.customer)==null?void 0:d.email)||"Unknown",status:r.status,moneyFormat:o,nextBillingDate:r.nextBillingDate,onRowClick:()=>{}}})},B={title:"Subscriptions",breadcrumb:[{href:M.subscriptions.dashboard,name:"Products"},{name:"List"}]},fe=({responseData:a,first:l})=>e.jsxs("div",{children:[e.jsx($,{title:B.title,breadcrumb:B.breadcrumb,children:e.jsx("div",{className:"mt-4 flex items-center gap-3 lg:mt-0",children:e.jsx(L,{to:M.subscriptions.dashboard,className:"w-full lg:w-auto"})})}),e.jsx(ge,{responseData:a,pageSize:l})]}),Ie=()=>{const{apiKey:a,response:l,first:n}=le();return Y()?e.jsx(fe,{responseData:l,first:n}):null};export{Ie as default};
